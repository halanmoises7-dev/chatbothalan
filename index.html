<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat Interativo - Halan Mois√©s</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        html, body {
            margin: 0; padding: 0; height: 100%; overflow: hidden;
            font-family: 'Montserrat', sans-serif;
            background: #f5f5f5; display: flex;
            justify-content: center; align-items: center;
        }
        .chat-container {
            width: 100%; max-width: 450px; 
            height: 100dvh;
            background: #fff; border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; overflow: hidden;
        }
        .chat-header {
            background: #ff7b00; color: white; padding: 15px;
            text-align: center; font-weight: 600; font-size: 18px;
        }
        .chat-body {
            flex: 1; padding: 15px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 10px;
            scroll-behavior: smooth;
        }
        .message {
            max-width: 85%; padding: 10px 14px; border-radius: 18px;
            line-height: 1.4; font-size: 15px; word-wrap: break-word;
        }
        .bot { background: #f0f0f0; align-self: flex-start; border-bottom-left-radius: 0; }
        .user { background: #ff7b00; color: white; align-self: flex-end; border-bottom-right-radius: 0; }
        .options-message {
            display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;
        }
        .option-btn {
            flex: 1 1 45%; background: #ff7b00; color: white;
            border: none; border-radius: 10px; padding: 10px 8px;
            font-size: 13px; cursor: pointer; 
            transition: background 0.2s, transform 0.1s;
            text-align: center;
        }
        .option-btn:hover { background: #e96f00; }
        .option-btn:active { transform: scale(0.97); }
        .end-btn { background: #d32f2f; }
        .end-btn:hover { background: #b71c1c; }
        .reset-btn { background: #007bff; }
        .reset-btn:hover { background: #0069d9; }
        .input-section {
            flex-shrink: 0; background: #fff; border-top: 1px solid #eee;
            display: flex; flex-direction: column; align-items: center; padding: 10px;
        }
        .input-bar {
            display: flex; align-items: center; width: 100%;
        }
        .input-bar input {
            flex: 1; padding: 10px 12px; border-radius: 12px;
            border: 1px solid #ddd; font-size: 14px; outline: none;
        }
        .send-btn {
            margin-left: 8px; background: #ff7b00; border: none;
            color: white; border-radius: 12px; padding: 10px 14px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .send-btn:hover { background: #e96f00; }
        .send-btn:active { transform: scale(0.95); }
        .send-btn svg { width: 18px; height: 18px; fill: white; }
        .footer {
            font-size: 12px; color: #888; margin-top: 6px; text-align: center;
        }
        .typing { font-style: italic; color: #777; }
        .fade-in { opacity: 0; animation: fadeIn 0.5s forwards; }
        @keyframes fadeIn { to { opacity: 1; } }
        a { color: #ff7b00; text-decoration: none; }
        .user a { color: white; }

        .whatsapp-block {
            display: block;
            background: #f7f7f7;
            padding: 10px;
            border-radius: 12px;
            margin-top: 8px;
        }
        .whatsapp-block p {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #333;
        }
        .whatsapp-btn {
            display: inline-block;
            background: #25d366;
            color: #fff;
            border: none;
            padding: 8px 14px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
        }
        .whatsapp-btn:hover { background: #1ebe5b; }
    </style>
</head>
<body>
    <div class="chat-container" role="main">
        <div class="chat-header">Atendimento Halan Mois√©s</div>
        <div class="chat-body" id="chatBody">
            <div class="message bot fade-in">Ol√°! üëã Sou o assistente do Halan Mois√©s. Qual √© o seu nome?</div>
        </div>

        <div class="input-section">
            <div class="input-bar">
                <input type="text" id="userInput" placeholder="Digite seu nome..." aria-label="Campo de entrada de texto" />
                <button class="send-btn" aria-label="Enviar Mensagem">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M2 21l21-9L2 3v7l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
            <div class="footer">Desenvolvido por <strong>Halan Mois√©s</strong></div>
        </div>
    </div>

    <script>
    // IIFE (Immediately Invoked Function Expression) para encapsulamento
    (function() {
        // 1. Vari√°veis de Estado e Refer√™ncias ao DOM (Agora Privadas)
        const chatBody = document.getElementById('chatBody');
        const userInput = document.getElementById('userInput');
        const sendButton = document.querySelector('.send-btn');
        
        let userName = '';
        let chatActive = true;
        let hasSelectedOption = false;

        const allOptions = ['fotografia', 'design', 'video', 'web', 'redes'];
        let remainingOptions = [...allOptions];

        // 2. Fun√ß√µes de Utilidade (Privadas)

        // Fun√ß√£o segura contra XSS: usa textContent
        function addMessage(sender, text) {
            const msg = document.createElement('div');
            msg.classList.add('message', sender, 'fade-in');
            msg.textContent = text;
            chatBody.appendChild(msg);
            chatBody.scrollTop = chatBody.scrollHeight;
        }
        
        function toggleInput(state, placeholder = 'Digite uma mensagem...') {
            userInput.disabled = !state;
            sendButton.disabled = !state;
            userInput.placeholder = state ? placeholder : 'Aguarde a resposta do assistente...';
        }

        // Fun√ß√£o auxiliar para respostas do bot que podem conter HTML (links)
        function addBotResponse(text) {
            const msg = document.createElement('div');
            msg.classList.add('message', 'bot', 'fade-in');
            
            // Usamos innerHTML AQUI, pois o texto √© controlado por n√≥s (seguro)
            msg.innerHTML = text; 
            
            chatBody.appendChild(msg);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function addOptionsMessage() {
            const optionsContainer = document.createElement('div');
            optionsContainer.classList.add('message', 'bot', 'fade-in');

            let optionsHTML = '';
            
            if (remainingOptions.length > 0) {
                optionsHTML += 'Escolha uma op√ß√£o abaixo:';
                optionsHTML += `<div class="options-message">`;
                remainingOptions.forEach(option => {
                    let icon = '';
                    switch(option) {
                        case 'fotografia': icon = 'üì∏'; break;
                        case 'design': icon = 'üé®'; break;
                        case 'video': icon = 'üé¨'; break;
                        case 'web': icon = 'üíª'; break;
                        case 'redes': icon = 'üåê'; break;
                    }
                    // Adicionando data-attributes para event listeners
                    optionsHTML += `<button class="option-btn" data-action="select" data-option="${option}" aria-label="Op√ß√£o ${option}">${icon} ${option.charAt(0).toUpperCase() + option.slice(1)}</button>`;
                });

                if (hasSelectedOption) {
                    optionsHTML += `<button class="option-btn end-btn" data-action="end" aria-label="Encerrar Conversa">Encerrar ChatBot</button>`;
                }

                optionsHTML += `</div>`;
            } else {
                optionsHTML += `
                    Todas as op√ß√µes foram apresentadas.<br>O que deseja fazer agora?
                    <div class="options-message">
                        <button class="option-btn reset-btn" data-action="reset">üîÑ Voltar ao Menu</button>
                        <button class="option-btn end-btn" data-action="end">Encerrar ChatBot</button>
                    </div>
                `;
            }

            optionsContainer.innerHTML = optionsHTML;
            chatBody.appendChild(optionsContainer);
            chatBody.scrollTop = chatBody.scrollHeight;
            
            // NOVO: Anexar event listeners aos bot√µes rec√©m-criados
            attachOptionListeners();
        }

        function botTyping(text, delayPerChar = 10, callback = null) {
            toggleInput(false);
            
            const typing = document.createElement('div');
            typing.classList.add('message', 'bot', 'typing');
            typing.textContent = 'Digitando...';
            chatBody.appendChild(typing);
            chatBody.scrollTop = chatBody.scrollHeight;

            setTimeout(() => {
                typing.remove();
                addBotResponse(text); 
                
                if (chatActive && userName) toggleInput(true, 'Digite uma mensagem...');
                else if (chatActive) toggleInput(true, 'Digite seu nome...');

                if (callback) callback();
            }, text.length * delayPerChar);
        }

        // 3. L√≥gica Principal do Chat (Privada)

        function sendMessage() {
            const text = userInput.value.trim();
            if (text === '' || !chatActive || userInput.disabled) return;

            if (!userName) {
                userName = text;
                addMessage('user', userName);
                userInput.value = '';
                userInput.placeholder = 'Digite uma mensagem...'; 
                botTyping(`Seja bem-vindo(a), ${userName}! Estou aqui para apresentar meus servi√ßos.`, 10, () => {
                    addOptionsMessage();
                });
                return;
            }

            addMessage('user', text);
            userInput.value = '';
            
            botTyping(`Para demais d√∫vidas, ${userName}, entre em contato comigo via <a href="http://wa.me//5521965870535" target="_blank">WhatsApp</a>.`);
        }

        function selectOption(option) {
            if (!chatActive) return;

            // Valida√ß√£o de seguran√ßa e boas pr√°ticas
            if (!allOptions.includes(option)) return; 
            
            hasSelectedOption = true;
            addMessage('user', option.charAt(0).toUpperCase() + option.slice(1));

            let response = '';
            switch(option) {
                case 'fotografia':
                    response = `üì∏ Fotografia profissional: Realizo ensaios fotogr√°ficos para todos os estilos, valorizando sua imagem e momentos especiais. Pode conferir alguns trabalhos no meu site <a href="https://halanmoises.46graus.com/" target="_blank">Halan Mois√©s Fotografia</a>.`;
                    break;
                case 'design':
                    response = `üé® Design Digital: Cria√ß√£o de artes visuais, identidade visual e material promocional para empresas e projetos.`;
                    break;
                case 'video':
                    response = `üé¨ Videomaker: Produ√ß√£o de v√≠deos institucionais, promocionais e criativos com qualidade profissional.`;
                    break;
                case 'web':
                    response = `üíª Desenvolvimento Web: Cria√ß√£o e manuten√ß√£o de sites, landing pages e solu√ß√µes digitais personalizadas.`;
                    break;
                case 'redes':
                    response = `üåê Minhas Redes Sociais:<br>
                                <a href="https://www.instagram.com/halanmoisesfotografia" target="_blank">üì∏ Instagram</a><br>
                                <a href="https://www.tiktok.com/@halanmoises" target="_blank">üé∂ TikTok</a><br>
                                <a href="http://wa.me//5521965870535" target="_blank">üí¨ WhatsApp</a><br>
                                <a href="https://halanmoises.46graus.com/" target="_blank">üíª Site</a>`;
                    break;
            }

            remainingOptions = remainingOptions.filter(opt => opt !== option);

            botTyping(response, 10, () => {
                // Adiciona bloco WhatsApp
                if (['fotografia', 'design', 'video', 'web'].includes(option)) {
                    const waBlock = document.createElement('div');
                    waBlock.classList.add('message', 'bot', 'fade-in');
                    const serviceLabel = option.charAt(0).toUpperCase() + option.slice(1);
                    
                    const waMessageText = `Ol√°, Halan! Meu nome √© ${userName} e me interessei pelo servi√ßo de ${serviceLabel}.`;
                    const waLink = `https://wa.me/5521965870535?text=${encodeURIComponent(waMessageText)}`;

                    waBlock.innerHTML = `
                        <div class="whatsapp-block">
                            <p>Se quiser, envie agora seu interesse diretamente pelo WhatsApp clicando abaixo üëá</p>
                            <a href="${waLink}" target="_blank" class="whatsapp-btn">üì© Enviar interesse via WhatsApp</a>
                        </div>
                    `;
                    chatBody.appendChild(waBlock);
                    chatBody.scrollTop = chatBody.scrollHeight;
                }

                setTimeout(() => addOptionsMessage(), 300);
            });
        }

        function resetMenu() {
            if (!chatActive) return;
            remainingOptions = [...allOptions];
            addMessage('user', 'üîÑ Voltar ao Menu');
            botTyping('As op√ß√µes foram restauradas. Escolha uma delas abaixo:', 10, () => addOptionsMessage());
        }

        function endChat() {
            if (!chatActive) return;
            addMessage('user', 'Encerrar ChatBot');
            chatActive = false;
            toggleInput(false, 'Chat encerrado. Recarregue a p√°gina para come√ßar novamente.'); 

            botTyping(`O chat foi encerrado. At√© logo, ${userName}! üëã`, 10, () => {
                setTimeout(() => {
                    chatBody.innerHTML = '';
                    userName = '';
                    chatActive = true;
                    hasSelectedOption = false;
                    remainingOptions = [...allOptions];
                    addBotResponse('Ol√°! üëã Sou o assistente do Halan Mois√©s. Qual √© o seu nome?');
                    toggleInput(true, 'Digite seu nome...'); 
                }, 1500);
            });
        }

        // 4. Anexar Event Listeners (Conectando o HTML ao M√≥dulo Privado)

        function attachOptionListeners() {
            // Usa Event Delegation no chatBody para capturar cliques nos bot√µes de op√ß√£o
            const optionsContainer = chatBody.lastElementChild;
            if (!optionsContainer) return;

            optionsContainer.addEventListener('click', (e) => {
                const target = e.target.closest('.option-btn');
                if (!target) return;

                const action = target.getAttribute('data-action');
                const option = target.getAttribute('data-option');
                
                if (action === 'select' && option) {
                    selectOption(option);
                } else if (action === 'end') {
                    endChat();
                } else if (action === 'reset') {
                    resetMenu();
                }
            });
        }

        // Anexar listeners ao INPUT e ao BOT√ÉO DE ENVIO no carregamento inicial
        sendButton.addEventListener('click', sendMessage);
        
        userInput.addEventListener('keypress', e => {
            if (e.key === 'Enter') sendMessage();
        });

        // 5. Inicializa√ß√£o (Setup Inicial)
        toggleInput(true, 'Digite seu nome...');

    })(); // Fim da IIFE
    </script>
</body>
</html>
