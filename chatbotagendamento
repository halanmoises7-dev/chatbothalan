<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat Interativo - Halan Mois√©s</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- Vari√°veis CSS para Cores e Fontes --- */
        :root {
            --primary-color: #ff7b00;
            --primary-color-hover: #e96f00;
            --whatsapp-color: #25d366;
            --whatsapp-color-hover: #1ebe5b;
            --error-color: #d32f2f;
            --reset-color: #007bff;
            --reset-color-hover: #0069d9;
            --font-size-base: 15px;
        }

        * { box-sizing: border-box; }
        html, body {
            margin: 0; padding: 0; height: 100%; overflow: hidden;
            font-family: 'Montserrat', sans-serif;
            background: #f5f5f5; display: flex;
            justify-content: center; align-items: center;
        }
        .chat-container {
            width: 100%; max-width: 450px; 
            height: 100dvh;
            background: #fff; border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; overflow: hidden;
        }
        .chat-header {
            background: var(--primary-color); color: white; padding: 15px;
            text-align: center; font-weight: 600; font-size: 18px;
        }
        .chat-body {
            flex: 1; padding: 15px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 10px;
            scroll-behavior: smooth;
        }
        .message {
            max-width: 85%; padding: 10px 14px; border-radius: 18px;
            line-height: 1.4; font-size: var(--font-size-base); word-wrap: break-word;
        }
        .bot { background: #f0f0f0; align-self: flex-start; border-bottom-left-radius: 0; }
        .user { background: var(--primary-color); color: white; align-self: flex-end; border-bottom-right-radius: 0; }
        .options-message {
            display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;
        }
        .option-btn {
            flex: 1 1 45%; background: var(--primary-color); color: white;
            border: none; border-radius: 10px; padding: 10px 8px;
            font-size: 13px; cursor: pointer; 
            transition: background 0.2s, transform 0.1s;
            text-align: center;
        }
        .option-btn:hover { background: var(--primary-color-hover); }
        .option-btn:active { transform: scale(0.97); }
        .end-btn { background: var(--error-color); }
        .end-btn:hover { background: #b71c1c; }
        .reset-btn { background: var(--reset-color); }
        .reset-btn:hover { background: var(--reset-color-hover); }

        /* NOVO: Estilo para o bot√£o de Reiniciar Completo */
        .restart-btn {
            background: #4CAF50; 
            color: white;
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }
        .restart-btn:hover { background: #45a049; }
        
        .input-section {
            flex-shrink: 0; background: #fff; border-top: 1px solid #eee;
            display: flex; flex-direction: column; align-items: center; padding: 10px;
        }
        .input-bar {
            display: flex; align-items: center; width: 100%;
        }
        .input-bar input {
            flex: 1; padding: 10px 12px; border-radius: 12px;
            border: 1px solid #ddd; font-size: 14px; outline: none;
        }
        .input-bar input:disabled { background: #f9f9f9; color: #888; }
        .send-btn {
            margin-left: 8px; background: var(--primary-color); border: none;
            color: white; border-radius: 12px; padding: 10px 14px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .send-btn:hover { background: var(--primary-color-hover); }
        .send-btn:active { transform: scale(0.95); }
        .send-btn:disabled { opacity: 0.5; cursor: default; }
        .send-btn svg { width: 18px; height: 18px; fill: white; }
        .footer {
            font-size: 12px; color: #888; margin-top: 6px; text-align: center;
        }
        .typing { font-style: italic; color: #777; }
        .fade-in { opacity: 0; animation: fadeIn 0.5s forwards; }
        @keyframes fadeIn { to { opacity: 1; } }
        a { color: var(--primary-color); text-decoration: none; }
        .user a { color: white; }

        /* Estilos do Bloco de Confirma√ß√£o Final */
        .whatsapp-block {
            display: block;
            background: #f7f7f7;
            padding: 10px;
            border-radius: 12px;
            margin-top: 8px;
            text-align: center;
        }
        .whatsapp-block p {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #333;
        }
        .whatsapp-btn {
            display: inline-block;
            background: var(--whatsapp-color);
            color: #fff;
            border: none;
            padding: 10px 18px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.2s;
        }
        .whatsapp-btn:hover { background: var(--whatsapp-color-hover); }
    </style>
</head>
<body>
    <div class="chat-container" role="main">
        <div class="chat-header">Atendimento Halan Mois√©s</div>
        <div class="chat-body" id="chatBody">
            <div class="message bot fade-in">Ol√°! üëã Sou o assistente do Halan Mois√©s. Qual √© o seu nome?</div>
        </div>

        <div class="input-section">
            <div class="input-bar">
                <input type="text" id="userInput" placeholder="Digite seu nome..." aria-label="Campo de entrada de texto" />
                <button class="send-btn" aria-label="Enviar Mensagem">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M2 21l21-9L2 3v7l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
            <div class="footer">Desenvolvido por <strong>Halan Mois√©s</strong></div>
        </div>
    </div>

    <script>
    (function() {
        // --- 1. Vari√°veis de Estado e Refer√™ncias ao DOM ---
        const chatBody = document.getElementById('chatBody');
        const userInput = document.getElementById('userInput');
        const sendButton = document.querySelector('.send-btn');
        
        // ** SEU N√öMERO DE TELEFONE DO WHATSAPP ** (Formato: 5521999999999)
        const WHATSAPP_NUMBER = '5521965870535'; 

        let userName = '';
        let chatActive = true;
        let hasSelectedOption = false;

        const allOptions = ['fotografia', 'design', 'video', 'web', 'redes'];
        let remainingOptions = [...allOptions];

        // Vari√°veis de Hor√°rio de Atendimento
        const START_HOUR = 9; // 9:00
        const END_HOUR = 18; // 18:00
        const EXPEDIENT_INFO = `${START_HOUR}:00h √†s ${END_HOUR}:00h`;

        // Vari√°veis de Estado para o Fluxo de Agendamento
        let appointmentState = 0; // 0: Menu, 3: Aguardando Hor√°rio
        let requestedService = '';
        let requestedDate = '';
        let requestedTime = '';
        
        // --- 2. Fun√ß√µes de Utilidade e DOM ---

        function addMessage(sender, text) {
            const msg = document.createElement('div');
            msg.classList.add('message', sender, 'fade-in');
            msg.textContent = text;
            chatBody.appendChild(msg);
            chatBody.scrollTop = chatBody.scrollHeight;
        }
        
        function toggleInput(state, placeholder = 'Digite uma mensagem...') {
            userInput.disabled = !state;
            sendButton.disabled = !state;
            userInput.placeholder = state ? placeholder : 'Aguarde a resposta do assistente...';
        }

        function addBotResponse(text) {
            const msg = document.createElement('div');
            msg.classList.add('message', 'bot', 'fade-in');
            msg.innerHTML = text; 
            chatBody.appendChild(msg);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function addOptionsMessage() {
            const optionsContainer = document.createElement('div');
            optionsContainer.classList.add('message', 'bot', 'fade-in');

            let optionsHTML = '';
            
            if (remainingOptions.length > 0) {
                optionsHTML += 'Escolha uma op√ß√£o abaixo:';
                optionsHTML += `<div class="options-message">`;
                remainingOptions.forEach(option => {
                    let icon = '';
                    switch(option) {
                        case 'fotografia': icon = 'üì∏'; break;
                        case 'design': icon = 'üé®'; break;
                        case 'video': icon = 'üé¨'; break;
                        case 'web': icon = 'üíª'; break;
                        case 'redes': icon = 'üåê'; break;
                    }
                    optionsHTML += `<button class="option-btn" data-action="select" data-option="${option}" aria-label="Op√ß√£o ${option}">${icon} ${option.charAt(0).toUpperCase() + option.slice(1)}</button>`;
                });

                if (hasSelectedOption) {
                    optionsHTML += `<button class="option-btn end-btn" data-action="end" aria-label="Encerrar Conversa">Encerrar ChatBot</button>`;
                }

                optionsHTML += `</div>`;
            } else {
                optionsHTML += `
                    Todas as op√ß√µes foram apresentadas.<br>O que deseja fazer agora?
                    <div class="options-message">
                        <button class="option-btn reset-btn" data-action="reset">üîÑ Voltar ao Menu</button>
                        <button class="option-btn end-btn" data-action="end">Encerrar ChatBot</button>
                    </div>
                `;
            }

            optionsContainer.innerHTML = optionsHTML;
            chatBody.appendChild(optionsContainer);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function botTyping(text, delayPerChar = 10, callback = null) {
            toggleInput(false);
            
            const typing = document.createElement('div');
            typing.classList.add('message', 'bot', 'typing');
            typing.textContent = 'Digitando...';
            chatBody.appendChild(typing);
            chatBody.scrollTop = chatBody.scrollHeight;

            const minDelay = 700;
            const typingTime = Math.max(text.length * delayPerChar, minDelay);

            setTimeout(() => {
                typing.remove();
                addBotResponse(text); 
                
                if (chatActive) {
                    if (userName && appointmentState === 0) {
                        toggleInput(true, 'Digite uma mensagem...');
                    } else if (userName && appointmentState > 0) {
                        toggleInput(true, 'Digite o hor√°rio exato (ex: 14:00)...');
                    } else if (!userName) {
                        toggleInput(true, 'Digite seu nome...');
                    }
                }

                if (callback) callback();
            }, typingTime);
        }
        
        // --- 3. Fun√ß√µes de Valida√ß√£o e Envio ---

        function isValidTimeInExpedient(input) {
            const timeInput = input.includes(':') ? input : input + ':00'; 
            const timeRegex = /^([01]?[0-9]|2[0-3]):[0-5][0-9]$/; 
            
            if (!timeRegex.test(timeInput)) return false;

            const [hours, minutes] = timeInput.split(':').map(n => parseInt(n));

            return hours >= START_HOUR && hours < END_HOUR;
        }

        function startTodayScheduling(service) {
            requestedService = service.charAt(0).toUpperCase() + service.slice(1);
            requestedDate = new Date().toLocaleDateString('pt-BR'); 
            
            appointmentState = 3; 

            handleAppointmentFlow(''); 
        }

        function createWhatsappLink() {
            const message = `
Ol√° Halan!

*SOLICITA√á√ÉO DE AGENDAMENTO (Via ChatBot)*
*Cliente:* ${userName}
*Servi√ßo:* ${requestedService}
*Dia:* ${requestedDate} (HOJE)
*Hor√°rio Sugerido:* ${requestedTime}

*Aguardando sua confirma√ß√£o de disponibilidade.*
            `.trim(); 
            
            const encodedMessage = encodeURIComponent(message);

            return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`;
        }


        // --- 4. L√≥gica do Fluxo de Agendamento ---

        function handleAppointmentFlow(input) {
            if (input && appointmentState === 3) { 
                addMessage('user', input);
            }
            userInput.value = '';
            toggleInput(false);
            
            if (appointmentState === 3) {
                const timeInput = input.trim(); 

                if (timeInput === '') {
                    let responseInfo = `Certo! Para <strong>${requestedService}</strong> hoje (${requestedDate}), nosso expediente √© de <strong>${EXPEDIENT_INFO}</strong>.`;
                    responseInfo += `<br>Por favor, <strong>digite o hor√°rio exato</strong> que voc√™ gostaria de ser atendido (Ex: 10:00 ou 16:30).`;
                    botTyping(responseInfo, 10, () => {
                        toggleInput(true, 'Digite o hor√°rio desejado (Ex: 14:00)...');
                    });
                    return;
                }

                if (!isValidTimeInExpedient(timeInput)) {
                    let responseError = `Hor√°rio inv√°lido. Por favor, digite um hor√°rio no formato <strong>HH:MM</strong> dentro do nosso expediente (<strong>${EXPEDIENT_INFO}</strong>).`;
                    botTyping(responseError, 10, () => { toggleInput(true, 'Digite o hor√°rio exato (ex: 14:00)...'); });
                    return;
                }
                
                requestedTime = timeInput; 
                
                // FINALIZA√á√ÉO DO FLUXO
                let responseFinal = `‚úÖ <strong>Solicita√ß√£o de Agendamento Finalizada!</strong>`;
                responseFinal += `<br>Seu hor√°rio sugerido para <strong>${requestedService}</strong> hoje (${requestedDate}) √© <strong>${requestedTime}</strong>.`;
                responseFinal += `<br>Para que eu possa <strong>confirmar sua reserva</strong>, clique no bot√£o abaixo para me enviar os dados pelo WhatsApp.`;

                appointmentState = 0; 

                botTyping(responseFinal, 10, () => {
                    const finalBlock = document.createElement('div');
                    finalBlock.classList.add('message', 'bot', 'fade-in');
                    
                    finalBlock.innerHTML = `
                        <div class="whatsapp-block">
                            <p>Sua solicita√ß√£o de agendamento est√° pronta para ser enviada!</p>
                            <a href="${createWhatsappLink()}" target="_blank" class="whatsapp-btn">
                                üì≤ Enviar Solicita√ß√£o para WhatsApp
                            </a>
                        </div>
                    `;
                    chatBody.appendChild(finalBlock);
                    chatBody.scrollTop = chatBody.scrollHeight;
                    
                    setTimeout(() => {
                        remainingOptions = [...allOptions];
                        addOptionsMessage();
                    }, 500);
                });
            }
        }

        // --- 5. Fun√ß√µes de Controle do Chat ---

        function sendMessage() {
            const text = userInput.value.trim();
            if (text === '' || !chatActive || userInput.disabled) return;

            if (!userName) {
                // Valida√ß√£o de nome de usu√°rio
                if (text.length < 2) {
                    botTyping('Por favor, digite um nome v√°lido e com no m√≠nimo 2 caracteres.', 10, () => {
                        toggleInput(true, 'Digite seu nome...');
                    });
                    userInput.value = '';
                    return;
                }

                userName = text;
                addMessage('user', userName);
                userInput.value = '';
                userInput.placeholder = 'Digite uma mensagem...'; 
                botTyping(`Seja bem-vindo(a), ${userName}! Estou aqui para apresentar meus servi√ßos.`, 10, () => {
                    addOptionsMessage();
                });
                return;
            }

            if (appointmentState > 0) {
                handleAppointmentFlow(text);
                return;
            }

            addMessage('user', text);
            userInput.value = '';
            
            botTyping(`Para demais d√∫vidas, ${userName}, entre em contato comigo via <a href="http://wa.me//${WHATSAPP_NUMBER}" target="_blank">WhatsApp</a>.`, 10, () => {
                addOptionsMessage(); 
            });
        }

        function selectOption(option) {
            if (!chatActive) return;
            if (!allOptions.includes(option)) return; 
            
            hasSelectedOption = true;
            addMessage('user', option.charAt(0).toUpperCase() + option.slice(1));

            let response = '';
            
            switch(option) {
                case 'fotografia':
                    response = `üì∏ <strong>Fotografia profissional</strong>: Realizo ensaios fotogr√°ficos para todos os estilos, valorizando sua imagem e momentos especiais. Pode conferir alguns trabalhos no meu site <a href="https://halanmoises.46graus.com/" target="_blank">Halan Mois√©s Fotografia</a>.`;
                    break;
                case 'design':
                    response = `üé® <strong>Design Digital</strong>: Cria√ß√£o de artes visuais, identidade visual e material promocional para empresas e projetos.`;
                    break;
                case 'video':
                    response = `üé¨ <strong>Videomaker</strong>: Produ√ß√£o de v√≠deos institucionais, promocionais e criativos com qualidade profissional.`;
                    break;
                case 'web':
                    response = `üíª <strong>Desenvolvimento Web</strong>: Cria√ß√£o e manuten√ß√£o de sites, landing pages e solu√ß√µes digitais personalizadas.`;
                    break;
                case 'redes':
                    response = `üåê <strong>Minhas Redes Sociais</strong>:<br>
                                     <a href="https://www.instagram.com/halanmoisesfotografia" target="_blank">üì∏ Instagram</a><br>
                                     <a href="https://www.tiktok.com/@halanmoises" target="_blank">üé∂ TikTok</a><br>
                                     <a href="http://wa.me//${WHATSAPP_NUMBER}" target="_blank">üí¨ WhatsApp</a><br>
                                     <a href="https://halanmoises.46graus.com/" target="_blank">üíª Site</a>`;
                    break;
            }

            remainingOptions = remainingOptions.filter(opt => opt !== option);

            botTyping(response, 10, () => {
                const isService = ['fotografia', 'design', 'video', 'web'].includes(option);

                if (isService) {
                    const agendamentoBlock = document.createElement('div');
                    agendamentoBlock.classList.add('message', 'bot', 'fade-in');
                    
                    const serviceLabel = option.charAt(0).toUpperCase() + option.slice(1);
                    
                    agendamentoBlock.innerHTML = `
                        <p>Se voc√™ gostou de <strong>${serviceLabel}</strong>, inicie uma solicita√ß√£o de agendamento para <strong>HOJE</strong>!</p>
                        <div class="options-message">
                            <button class="option-btn" data-action="schedule-today" data-service="${option}">üìÖ Solicitar Agendamento para Hoje</button>
                        </div>
                    `;
                    chatBody.appendChild(agendamentoBlock);
                    chatBody.scrollTop = chatBody.scrollHeight;
                }

                setTimeout(() => addOptionsMessage(), 300);
            });
        }

        function resetMenu() {
            if (!chatActive) return;
            remainingOptions = [...allOptions];
            addMessage('user', 'üîÑ Voltar ao Menu');
            botTyping('As op√ß√µes foram restauradas. Escolha uma delas abaixo:', 10, () => addOptionsMessage());
        }

        /**
         * NOVO: Fun√ß√£o para reiniciar o chat completamente (estado e interface)
         */
        function fullReset() {
            // 1. Limpa o hist√≥rico visual
            chatBody.innerHTML = '';
            
            // 2. Reseta todas as vari√°veis de estado
            userName = '';
            appointmentState = 0;
            chatActive = true;
            hasSelectedOption = false;
            remainingOptions = [...allOptions];
            
            // 3. Inicia a conversa
            addBotResponse('Ol√°! üëã Sou o assistente do Halan Mois√©s. Qual √© o seu nome?');
            toggleInput(true, 'Digite seu nome...');
        }


        /**
         * Fun√ß√£o para encerrar o chat e apresentar o bot√£o de rein√≠cio
         */
        function endChat() {
            if (!chatActive) return;
            addMessage('user', 'Encerrar ChatBot');
            chatActive = false;
            
            toggleInput(false, 'Chat encerrado.'); 

            botTyping(`O chat foi encerrado. At√© logo, ${userName}! üëã`, 10, () => {
                // Adiciona o bloco com o bot√£o de reiniciar
                const restartBlock = document.createElement('div');
                restartBlock.classList.add('message', 'bot', 'fade-in');
                
                restartBlock.innerHTML = `
                    <p>Se precisar de algo mais, clique no bot√£o abaixo para come√ßar uma nova conversa.</p>
                    <button class="restart-btn" data-action="full-reset">üëã Reiniciar Conversa</button>
                `;
                chatBody.appendChild(restartBlock);
                chatBody.scrollTop = chatBody.scrollHeight;
            });
        }

        // --- 6. Event Listeners (Delegation) ---

        chatBody.addEventListener('click', (e) => {
            const target = e.target.closest('.option-btn, .restart-btn');
            if (!target) return;

            const action = target.getAttribute('data-action');
            const option = target.getAttribute('data-option');
            const service = target.getAttribute('data-service');
            
            if (appointmentState > 0 && action !== 'end' && action !== 'full-reset') return; 

            if (action === 'select' && option) {
                selectOption(option);
            } else if (action === 'schedule-today' && service) {
                toggleInput(false); 
                startTodayScheduling(service);
            } else if (action === 'end') {
                endChat();
            } else if (action === 'reset') {
                resetMenu();
            } else if (action === 'full-reset') {
                fullReset();
            }
        });

        sendButton.addEventListener('click', sendMessage);
        
        userInput.addEventListener('keypress', e => {
            if (e.key === 'Enter') sendMessage();
        });

        // 7. Inicializa√ß√£o
        toggleInput(true, 'Digite seu nome...');

    })(); 
    </script>
</body>
</html>
